// // @ts-ignore
// import { aoa_to_json, json_to_aoa, make_update_obj } from "../gapi/aoa_helpers"
// import { diff } from "deep-diff";
// import { clone } from 'ramda'

// export default [

//     {
//         test_name: 'Can turn products and orders json to aoa',
//         fn: async (expect, get_axios) => {
//             const axios = await get_axios('mendeljacks@gmail.com', 'test')

//             const { products } = await axios.post('/query', {
//                 include_vendors: '*',
//                 products: {
//                     select: ['id', 'brand'],
//                     variants: {
//                         select: ['id', 'sku'],
//                         variant_has_attributes: {
//                             select: ['id', 'attribute_id', 'attribute_value']
//                         }
//                     },
//                 },
//             })
//             const products_aoa = json_to_aoa({ products })
//             const products_json = aoa_to_json(products_aoa)
//             const products_original = { products }
//             const products_processed = products_json
//             const products_d = diff(products_original, products_processed)
//             expect(products_d).to.eql(undefined)

//             const { orders } = await axios.post('/query', {
//                 include_vendors: '*',
//                 orders: {
//                     select: ['id', 'name'],
//                     order_items: {
//                         select: ['id', 'variant_id'],
//                         variants: {
//                             select: ['id', 'sku']
//                         }
//                     }
//                 }
//             })
//             const orders_aoa = json_to_aoa({ orders })
//             const orders_json = aoa_to_json(orders_aoa)
//             const orders_original = { orders }
//             const orders_processed = orders_json
//             const orders_d = diff(orders_original, orders_processed)
//             expect(orders_d).to.eql(undefined)

//         }
//     },
//     {
//         test_name: 'Conversion works starting with sheet aoa',
//         fn: async (expect, get_axios) => {

//             const my_aoa = [
//                 ["Orders", "", "", "Orders > Order Items", "", "", "Orders > Order Items > Order Item 3pl Info", "", "", "", ""],
//                 ["Id", "Name", "Note", "Id", "Variant Id", "Quantity", "Id", "Shipping Fee", "Picking Fee", "Shipping Fee Tax", "Picking Fee Tax"],
//                 ["1532", "223", "k", "71", "353300179", "1", "5", "0", "3", "0", "2.25"], ["1533", "666", "", "72", "353300179", "2", "6", "0", "3", "0", "0.15"], ["", "", "", "73", "353300137", "1", "7", "0", "3", "0", "0.15"], ["1534", "jn", "", "74", "353300179", "1", "8", "0", "3", "0", "0.15"], ["1535", "s", "", "75", "353300179", "1", "9", "0", "3", "0", "0.15"], ["1536", "b", "", "76", "353300179", "2", "10", "0", "6", "0", "0.3"], ["1544", "Test order", "", "86", "353300179", "1", "11", "", "3", "0.5", "0.15"], ["", "", "", "87", "353300179", "2", "12", "", "3", "1", "0.15"], ["1545", "Test order", "", "88", "353300179", "1", "13", "", "3", "0.5", "0.15"], ["", "", "", "89", "353300179", "2", "14", "", "3", "1", "0.15"], ["1546", "Test order", "", "90", "353300179", "1", "15", "", "3", "0.5", "0.15"], ["", "", "", "91", "353300179", "2", "16", "", "3", "1", "0.15"], ["", "", "", "92", "353300179", "3", "17", "", "3", "1.5", "0.15"], ["", "", "", "93", "353300179", "4", "18", "", "6", "2.01", "0.3"], ["1547", "Test order", "", "94", "353300179", "1", "19", "10.03", "3", "0.5", "0.15"], ["", "", "", "95", "353300179", "2", "20", "20.06", "3", "1", "0.15"], ["", "", "", "96", "353300179", "3", "21", "30.09", "3", "1.5", "0.15"], ["", "", "", "97", "353300179", "4", "22", "40.12", "6", "2.01", "0.3"], ["1548", "Test order", "", "98", "353300179", "1", "23", "10.03", "3", "0.5", "0.15"], ["", "", "", "99", "353300137", "4", "24", "48", "12", "2.4", "0.6"], ["1549", "Test order", "", "100", "353300179", "1", "25", "10.03", "3", "0.5", "0.15"], ["", "", "", "101", "353300137", "4", "26", "48", "12", "2.4", "0.6"], ["1550", "Test order", "", "102", "353300179", "1", "27", "10.05", "3", "0.5", "0.15"], ["", "", "", "103", "353300137", "4", "28", "48", "12", "2.4", "0.6"], ["1551", "Test order", "", "104", "353300179", "1", "29", "10.05", "3", "0.5", "0.15"], ["", "", "", "105", "353300137", "4", "30", "48", "12", "2.4", "0.6"], ["1552", "Test order", "", "106", "353300179", "1", "31", "10.05", "3", "0.5", "0.15"], ["", "", "", "107", "353300137", "4", "32", "48", "12", "2.4", "0.6"], ["1553", "Test order 3", "", "108", "353300179", "1", "33", "10.05", "3", "0.5", "0.15"], ["", "", "", "109", "353300137", "4", "34", "48", "12", "2.4", "0.6"], ["1554", "test", "set", "110", "353300179", "12", "35", "120.35", "12", "6", "0.6"], ["1555", "Test order", "", "111", "353300179", "2", "36", "0", "3", "0", "0.15"], ["1556", "", "", "112", "353300179", "2", "37", "0", "3", "0", "0.15"], ["1557", "", "", "113", "353300179", "2", "38", "0", "3", "0", "0.15"], ["1559", "", "", "115", "353300179", "2", "39", "0", "3", "0", "0.15"], ["1560", "kljhjk", "", "116", "353300030", "1", "40", "0", "3", "0", "0.15"], ["1561", "faasdfasdf", "tset", "117", "353300123", "2", "41", "0", "6", "0", "0.3"], ["1562", "lkl;", "", "118", "353300030", "6", "42", "0", "18", "0", "0.9"], ["1563", "dfgsdfgsdfg", "dfg", "119", "353300123", "1", "43", "0", "3", "0", "0.15"], ["1564", "send to shua", "", "120", "353300211", "6", "44", "0", "6", "0", "0.3"], ["1568", "", "", "124", "353300209", "1", "47", "0", "3", "0", "0.15"], ["1569", "", "", "125", "353300209", "1", "48", "0", "3", "0", "0.15"], ["1570", "", "", "126", "353300209", "1", "49", "12", "13", "0", "0"], ["1571", "", "", "127", "353300209", "1", "50", "0", "13", "0", "0"], ["1572", "", "", "128", "353300209", "1", "51", "12", "3", "0", "0"], ["1573", "", "", "129", "353300209", "1", "52", "0", "3", "0", "0.15"]]

//             const my_json = aoa_to_json(my_aoa)
//             const new_aoa = json_to_aoa(my_json)
//             const mydiff = diff(my_aoa, new_aoa)
//             expect(mydiff).to.eql(undefined)

//         }
//     },
//     {
//         test_name: 'Can diff a basic number and add in id',
//         fn: async (expect, get_axios) => {

//             const original_aoa = JSON.parse("[[\"Orders\",\"\",\"\",\"Orders > Order Items\",\"\",\"\",\"Orders > Order Items > Order Item 3pl Info\",\"\",\"\",\"\",\"\"],[\"Id\",\"Name\",\"Note\",\"Id\",\"Variant Id\",\"Quantity\",\"Id\",\"Shipping Fee\",\"Picking Fee\",\"Shipping Fee Tax\",\"Picking Fee Tax\"],[\"1532\",\"223\",\"k\",\"71\",\"353300179\",\"1\",\"5\",\"0\",\"3\",\"0\",\"2.25\"],[\"1533\",\"666\",\"\",\"72\",\"353300179\",\"2\",\"6\",\"0\",\"3\",\"0\",\"0.15\"],[\"\",\"\",\"\",\"73\",\"353300137\",\"1\",\"7\",\"0\",\"3\",\"0\",\"0.15\"],[\"1534\",\"jn\",\"\",\"74\",\"353300179\",\"1\",\"8\",\"0\",\"3\",\"0\",\"0.15\"],[\"1535\",\"s\",\"\",\"75\",\"353300179\",\"1\",\"9\",\"0\",\"3\",\"0\",\"0.15\"],[\"1536\",\"b\",\"\",\"76\",\"353300179\",\"2\",\"10\",\"0\",\"6\",\"0\",\"0.3\"],[\"1544\",\"Test order\",\"\",\"86\",\"353300179\",\"1\",\"11\",\"\",\"3\",\"0.5\",\"0.15\"],[\"\",\"\",\"\",\"87\",\"353300179\",\"2\",\"12\",\"\",\"3\",\"1\",\"0.15\"],[\"1545\",\"Test order\",\"\",\"88\",\"353300179\",\"1\",\"13\",\"\",\"3\",\"0.5\",\"0.15\"],[\"\",\"\",\"\",\"89\",\"353300179\",\"2\",\"14\",\"\",\"3\",\"1\",\"0.15\"],[\"1546\",\"Test order\",\"\",\"90\",\"353300179\",\"1\",\"15\",\"\",\"3\",\"0.5\",\"0.15\"],[\"\",\"\",\"\",\"91\",\"353300179\",\"2\",\"16\",\"\",\"3\",\"1\",\"0.15\"],[\"\",\"\",\"\",\"92\",\"353300179\",\"3\",\"17\",\"\",\"3\",\"1.5\",\"0.15\"],[\"\",\"\",\"\",\"93\",\"353300179\",\"4\",\"18\",\"\",\"6\",\"2.01\",\"0.3\"],[\"1547\",\"Test order\",\"\",\"94\",\"353300179\",\"1\",\"19\",\"10.03\",\"3\",\"0.5\",\"0.15\"],[\"\",\"\",\"\",\"95\",\"353300179\",\"2\",\"20\",\"20.06\",\"3\",\"1\",\"0.15\"],[\"\",\"\",\"\",\"96\",\"353300179\",\"3\",\"21\",\"30.09\",\"3\",\"1.5\",\"0.15\"],[\"\",\"\",\"\",\"97\",\"353300179\",\"4\",\"22\",\"40.12\",\"6\",\"2.01\",\"0.3\"],[\"1548\",\"Test order\",\"\",\"98\",\"353300179\",\"1\",\"23\",\"10.03\",\"3\",\"0.5\",\"0.15\"],[\"\",\"\",\"\",\"99\",\"353300137\",\"4\",\"24\",\"48\",\"12\",\"2.4\",\"0.6\"],[\"1549\",\"Test order\",\"\",\"100\",\"353300179\",\"1\",\"25\",\"10.03\",\"3\",\"0.5\",\"0.15\"],[\"\",\"\",\"\",\"101\",\"353300137\",\"4\",\"26\",\"48\",\"12\",\"2.4\",\"0.6\"],[\"1550\",\"Test order\",\"\",\"102\",\"353300179\",\"1\",\"27\",\"10.05\",\"3\",\"0.5\",\"0.15\"],[\"\",\"\",\"\",\"103\",\"353300137\",\"4\",\"28\",\"48\",\"12\",\"2.4\",\"0.6\"],[\"1551\",\"Test order\",\"\",\"104\",\"353300179\",\"1\",\"29\",\"10.05\",\"3\",\"0.5\",\"0.15\"],[\"\",\"\",\"\",\"105\",\"353300137\",\"4\",\"30\",\"48\",\"12\",\"2.4\",\"0.6\"],[\"1552\",\"Test order\",\"\",\"106\",\"353300179\",\"1\",\"31\",\"10.05\",\"3\",\"0.5\",\"0.15\"],[\"\",\"\",\"\",\"107\",\"353300137\",\"4\",\"32\",\"48\",\"12\",\"2.4\",\"0.6\"],[\"1553\",\"Test order 3\",\"\",\"108\",\"353300179\",\"1\",\"33\",\"10.05\",\"3\",\"0.5\",\"0.15\"],[\"\",\"\",\"\",\"109\",\"353300137\",\"4\",\"34\",\"48\",\"12\",\"2.4\",\"0.6\"],[\"1554\",\"test\",\"set\",\"110\",\"353300179\",\"12\",\"35\",\"120.35\",\"12\",\"6\",\"0.6\"],[\"1555\",\"Test order\",\"\",\"111\",\"353300179\",\"2\",\"36\",\"0\",\"3\",\"0\",\"0.15\"],[\"1556\",\"\",\"\",\"112\",\"353300179\",\"2\",\"37\",\"0\",\"3\",\"0\",\"0.15\"],[\"1557\",\"\",\"\",\"113\",\"353300179\",\"2\",\"38\",\"0\",\"3\",\"0\",\"0.15\"],[\"1559\",\"\",\"\",\"115\",\"353300179\",\"2\",\"39\",\"0\",\"3\",\"0\",\"0.15\"],[\"1560\",\"kljhjk\",\"\",\"116\",\"353300030\",\"1\",\"40\",\"0\",\"3\",\"0\",\"0.15\"],[\"1561\",\"faasdfasdf\",\"tset\",\"117\",\"353300123\",\"2\",\"41\",\"0\",\"6\",\"0\",\"0.3\"],[\"1562\",\"lkl;\",\"\",\"118\",\"353300030\",\"6\",\"42\",\"0\",\"18\",\"0\",\"0.9\"],[\"1563\",\"dfgsdfgsdfg\",\"dfg\",\"119\",\"353300123\",\"1\",\"43\",\"0\",\"3\",\"0\",\"0.15\"],[\"1564\",\"send to shua\",\"\",\"120\",\"353300211\",\"6\",\"44\",\"0\",\"6\",\"0\",\"0.3\"],[\"1568\",\"\",\"\",\"124\",\"353300209\",\"1\",\"47\",\"0\",\"3\",\"0\",\"0.15\"],[\"1569\",\"\",\"\",\"125\",\"353300209\",\"1\",\"48\",\"0\",\"3\",\"0\",\"0.15\"],[\"1570\",\"\",\"\",\"126\",\"353300209\",\"1\",\"49\",\"12\",\"13\",\"0\",\"0\"],[\"1571\",\"\",\"\",\"127\",\"353300209\",\"1\",\"50\",\"0\",\"13\",\"0\",\"0\"],[\"1572\",\"\",\"\",\"128\",\"353300209\",\"1\",\"51\",\"12\",\"3\",\"0\",\"0\"],[\"1573\",\"\",\"\",\"129\",\"353300209\",\"1\",\"52\",\"0\",\"3\",\"0\",\"0.15\"]]")
//             const modified_aoa = JSON.parse("[[\"Orders\",\"\",\"\",\"Orders > Order Items\",\"\",\"\",\"Orders > Order Items > Order Item 3pl Info\",\"\",\"\",\"\",\"\"],[\"Id\",\"Name\",\"Note\",\"Id\",\"Variant Id\",\"Quantity\",\"Id\",\"Shipping Fee\",\"Picking Fee\",\"Shipping Fee Tax\",\"Picking Fee Tax\"],[\"1532\",\"223\",\"k\",\"71\",\"353300179\",\"1\",\"5\",\"0\",\"3\",\"9\",\"2.25\"],[\"1533\",\"666\",\"\",\"72\",\"353300179\",\"2\",\"6\",\"0\",\"3\",\"0\",\"0.15\"],[\"\",\"\",\"\",\"73\",\"353300137\",\"1\",\"7\",\"0\",\"3\",\"0\",\"0.15\"],[\"1534\",\"jn\",\"\",\"74\",\"353300179\",\"1\",\"8\",\"0\",\"3\",\"0\",\"0.15\"],[\"1535\",\"s\",\"\",\"75\",\"353300179\",\"1\",\"9\",\"0\",\"3\",\"0\",\"0.15\"],[\"1536\",\"b\",\"\",\"76\",\"353300179\",\"2\",\"10\",\"0\",\"6\",\"0\",\"0.3\"],[\"1544\",\"Test order\",\"\",\"86\",\"353300179\",\"1\",\"11\",\"\",\"3\",\"0.5\",\"0.15\"],[\"\",\"\",\"\",\"87\",\"353300179\",\"2\",\"12\",\"\",\"3\",\"1\",\"0.15\"],[\"1545\",\"Test order\",\"\",\"88\",\"353300179\",\"1\",\"13\",\"\",\"3\",\"0.5\",\"0.15\"],[\"\",\"\",\"\",\"89\",\"353300179\",\"2\",\"14\",\"\",\"3\",\"1\",\"0.15\"],[\"1546\",\"Test order\",\"\",\"90\",\"353300179\",\"1\",\"15\",\"\",\"3\",\"0.5\",\"0.15\"],[\"\",\"\",\"\",\"91\",\"353300179\",\"2\",\"16\",\"\",\"3\",\"1\",\"0.15\"],[\"\",\"\",\"\",\"92\",\"353300179\",\"3\",\"17\",\"\",\"3\",\"1.5\",\"0.15\"],[\"\",\"\",\"\",\"93\",\"353300179\",\"4\",\"18\",\"\",\"6\",\"2.01\",\"0.3\"],[\"1547\",\"Test order\",\"\",\"94\",\"353300179\",\"1\",\"19\",\"10.03\",\"3\",\"0.5\",\"0.15\"],[\"\",\"\",\"\",\"95\",\"353300179\",\"2\",\"20\",\"20.06\",\"3\",\"1\",\"0.15\"],[\"\",\"\",\"\",\"96\",\"353300179\",\"3\",\"21\",\"30.09\",\"3\",\"1.5\",\"0.15\"],[\"\",\"\",\"\",\"97\",\"353300179\",\"4\",\"22\",\"40.12\",\"6\",\"2.01\",\"0.3\"],[\"1548\",\"Test order\",\"\",\"98\",\"353300179\",\"1\",\"23\",\"10.03\",\"3\",\"0.5\",\"0.15\"],[\"\",\"\",\"\",\"99\",\"353300137\",\"4\",\"24\",\"48\",\"12\",\"2.4\",\"0.6\"],[\"1549\",\"Test order\",\"\",\"100\",\"353300179\",\"1\",\"25\",\"10.03\",\"3\",\"0.5\",\"0.15\"],[\"\",\"\",\"\",\"101\",\"353300137\",\"4\",\"26\",\"48\",\"12\",\"2.4\",\"0.6\"],[\"1550\",\"Test order\",\"\",\"102\",\"353300179\",\"1\",\"27\",\"10.05\",\"3\",\"0.5\",\"0.15\"],[\"\",\"\",\"\",\"103\",\"353300137\",\"4\",\"28\",\"48\",\"12\",\"2.4\",\"0.6\"],[\"1551\",\"Test order\",\"\",\"104\",\"353300179\",\"1\",\"29\",\"10.05\",\"3\",\"0.5\",\"0.15\"],[\"\",\"\",\"\",\"105\",\"353300137\",\"4\",\"30\",\"48\",\"12\",\"2.4\",\"0.6\"],[\"1552\",\"Test order\",\"\",\"106\",\"353300179\",\"1\",\"31\",\"10.05\",\"3\",\"0.5\",\"0.15\"],[\"\",\"\",\"\",\"107\",\"353300137\",\"4\",\"32\",\"48\",\"12\",\"2.4\",\"0.6\"],[\"1553\",\"Test order 3\",\"\",\"108\",\"353300179\",\"1\",\"33\",\"10.05\",\"3\",\"0.5\",\"0.15\"],[\"\",\"\",\"\",\"109\",\"353300137\",\"4\",\"34\",\"48\",\"12\",\"2.4\",\"0.6\"],[\"1554\",\"test\",\"set\",\"110\",\"353300179\",\"12\",\"35\",\"120.35\",\"12\",\"6\",\"0.6\"],[\"1555\",\"Test order\",\"\",\"111\",\"353300179\",\"2\",\"36\",\"0\",\"3\",\"0\",\"0.15\"],[\"1556\",\"\",\"\",\"112\",\"353300179\",\"2\",\"37\",\"0\",\"3\",\"0\",\"0.15\"],[\"1557\",\"\",\"\",\"113\",\"353300179\",\"2\",\"38\",\"0\",\"3\",\"0\",\"0.15\"],[\"1559\",\"\",\"\",\"115\",\"353300179\",\"2\",\"39\",\"0\",\"3\",\"0\",\"0.15\"],[\"1560\",\"kljhjk\",\"\",\"116\",\"353300030\",\"1\",\"40\",\"0\",\"3\",\"0\",\"0.15\"],[\"1561\",\"faasdfasdf\",\"tset\",\"117\",\"353300123\",\"2\",\"41\",\"0\",\"6\",\"0\",\"0.3\"],[\"1562\",\"lkl;\",\"\",\"118\",\"353300030\",\"6\",\"42\",\"0\",\"18\",\"0\",\"0.9\"],[\"1563\",\"dfgsdfgsdfg\",\"dfg\",\"119\",\"353300123\",\"1\",\"43\",\"0\",\"3\",\"0\",\"0.15\"],[\"1564\",\"send to shua\",\"\",\"120\",\"353300211\",\"6\",\"44\",\"0\",\"6\",\"0\",\"0.3\"],[\"1568\",\"\",\"\",\"124\",\"353300209\",\"1\",\"47\",\"0\",\"3\",\"0\",\"0.15\"],[\"1569\",\"\",\"\",\"125\",\"353300209\",\"1\",\"48\",\"0\",\"3\",\"0\",\"0.15\"],[\"1570\",\"\",\"\",\"126\",\"353300209\",\"1\",\"49\",\"12\",\"13\",\"0\",\"0\"],[\"1571\",\"\",\"\",\"127\",\"353300209\",\"1\",\"50\",\"0\",\"13\",\"0\",\"0\"],[\"1572\",\"\",\"\",\"128\",\"353300209\",\"1\",\"51\",\"12\",\"3\",\"0\",\"0\"],[\"1573\",\"\",\"\",\"129\",\"353300209\",\"1\",\"52\",\"0\",\"3\",\"0\",\"0.15\"]]")

//             const original_json = aoa_to_json(original_aoa)
//             const modified_json = aoa_to_json(modified_aoa)

//             const update_obj = make_update_obj(original_json, modified_json)

//             expect(update_obj).to.eql({
//                 "orders": [
//                     {
//                         "id": "1532",
//                         "order_items": [
//                             {
//                                 "id": "71",
//                                 "order_item_3pl_info": [
//                                     {
//                                         "shipping_fee_tax": "9",
//                                         "id": "5"
//                                     }
//                                 ]
//                             }
//                         ]
//                     }
//                 ]
//             })

//         }
//     },
//     {
//         test_name: 'Can change the second line item in the order',
//         fn: async (expect, get_axios) => {
//             const axios = await get_axios('mendeljacks@gmail.com', 'test')
//             const orders_body = {
//                 "include_vendors": "*",
//                 "orders": {
//                     select: ['*'],
//                     where: {in: ['id', [1,105]]}
//                 }
//             }
//             const { orders } = await axios.post('/query', orders_body)

//             let modified_orders = clone({ orders })
//             modified_orders.orders[1].order_items[1].order_item_3pl_info[0].shipping_fee = 21

//             const update_obj = make_update_obj({ orders }, modified_orders)

//             // Purpose of this test
//             // 1: When the modification is not in position 0, there will be null padding due to assoc-path-fast putting in array
//             // 2: When the modification is only in a child table, the ids of the parent tables are not included and possibly not available?

//             expect(update_obj).to.eql({
//                 "orders": [{
//                     "id": 105,
//                     "order_items": [{
//                         "id": 139,
//                         "order_item_3pl_info": [{
//                             "id": 114,
//                             "shipping_fee": 21
//                         }]
//                     }]
//                 }]
//             })

//         }
//     }
// ]

import { expect } from 'chai'
import {describe, test } from 'mocha'
import { aoa_to_json } from './aoa'

describe('aoa.ts', () => {
    describe(aoa_to_json.name, () => {
        test('handles repeat children', () => {
            const aoa = [
                ['Variants', 'Variants > Images', '', 'Variants > Images'],
                ['Mpn', 'Source Url', 'Bucket Url', 'Source Url'],
                ['123', 'a.com/1.jpg', 'b.com/1.jpg', 'a.com/2.jpg'],
                ['', '', '', 'a.com/3.jpg']
            ]

            const json = aoa_to_json(aoa)
            expect(json).to.deep.equal({
                variants: [{
                    mpn: '123',
                    images: [{
                        source_url: 'a.com/1.jpg',
                        bucket_url: 'b.com/1.jpg'
                    }, {
                        source_url: 'a.com/2.jpg'
                    }, {
                        source_url: 'a.com/3.jpg'
                    }]
                }]
            })
        })
    })
})